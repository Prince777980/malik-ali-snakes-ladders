import pygame
import random
import sys
import os # ูุงุณุชุฎุฏุงู ูุณุงุฑุงุช ุงููููุงุช ุจุดูู ุตุญูุญ

# --- ุฅุนุฏุงุฏุงุช ุงููุนุจุฉ ุงูุฃุณุงุณูุฉ ---
pygame.init()
pygame.mixer.init() # ูุชููุฆุฉ ูุญุฏุฉ ุงูุตูุช (ููู ููุฃุตูุงุช)

# ุฃุจุนุงุฏ ุงูุดุงุดุฉ
SCREEN_WIDTH = 800
SCREEN_HEIGHT = 650 # ุฒูุงุฏุฉ ุงูุงุฑุชูุงุน ููููุงู ููุงุฌูุฉ ุงููุณุชุฎุฏู
BOARD_SIZE = 600 # ุญุฌู ููุญุฉ ุงููุนุจ
SQUARE_SIZE = BOARD_SIZE // 10 # ุญุฌู ุงููุฑุจุน ุงููุงุญุฏ (ููุญุฉ 10x10)

# ุงูุฃููุงู
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
RED = (255, 0, 0)
GREEN = (0, 180, 0) # ุฃุฎุถุฑ ุฃุบูู ููููุงู
BLUE = (0, 0, 200)  # ุฃุฒุฑู ุฃุบูู ููููุงู
LIGHT_BLUE = (173, 216, 230)
YELLOW = (255, 255, 0) # ููุชูููุฒ ุงูุฅุถุงูู

# ุฅุนุฏุงุฏ ุงูุดุงุดุฉ
screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
pygame.display.set_caption('Snack Game (ูุนุจุฉ ุงูุณูู ูุงูุซุนุจุงู ุงูููุชุนุฉ!)')

# --- ุชุญููู ุงูููุงุฑุฏ (ุงูุตูุฑ ูุงูุฃุตูุงุช) ---
# ุชุฃูุฏ ูู ุฃู ูุฐู ุงููููุงุช ููุฌูุฏุฉ ูู ูุฌูุฏ 'assets' ุจููุณ ููุงู ููู ุงูููุฏ
asset_folder = 'assets'
try:
    # ุตูุฑุฉ ููุญุฉ ุงููุนุจ (ููููุฉ ููุงุถุญุฉ ููุฃุทูุงู)
    board_img = pygame.image.load(os.path.join(asset_folder, 'board.png')).convert()
    board_img = pygame.transform.scale(board_img, (BOARD_SIZE, BOARD_SIZE))

    # ุตูุฑ ูุทุน ุงููุงุนุจูู (ูุฑุชูููุฉ ููุทููุฉ)
    frog_img = pygame.image.load(os.path.join(asset_folder, 'frog.png')).convert_alpha()
    frog_img = pygame.transform.scale(frog_img, (SQUARE_SIZE // 2 + 5, SQUARE_SIZE // 2 + 5)) # ุฃูุจุฑ ููููุงู

    spongebob_img = pygame.image.load(os.path.join(asset_folder, 'spongebob.png')).convert_alpha()
    spongebob_img = pygame.transform.scale(spongebob_img, (SQUARE_SIZE // 2 + 5, SQUARE_SIZE // 2 + 5)) # ุฃูุจุฑ ููููุงู

    # ุตูุฑุฉ ุงููุฑุฏ
    dice_img_default = pygame.image.load(os.path.join(asset_folder, 'dice_default.png')).convert_alpha()
    dice_img_default = pygame.transform.scale(dice_img_default, (80, 80))

    # ุงูุฃุตูุงุช
    dice_sound = pygame.mixer.Sound(os.path.join(asset_folder, 'dice_roll.wav'))
    ladder_sound = pygame.mixer.Sound(os.path.join(asset_folder, 'ladder_climb.wav'))
    snake_sound = pygame.mixer.Sound(os.path.join(asset_folder, 'snake_slide.wav'))
    win_sound = pygame.mixer.Sound(os.path.join(asset_folder, 'win_game.wav'))

except pygame.error as e:
    print(f"ุฎุทุฃ ูุงุฏุญ ูู ุชุญููู ุงูููุงุฑุฏ: {e}")
    print("*"*30)
    print("!!! ุชุฃูุฏ ูู ูุฌูุฏ ูุฌูุฏ ุจุงุณู 'assets' ูู ููุณ ููุงู ููู ุงููุนุจุฉ !!!")
    print("!!! ูุชุฃูุฏ ูู ูุฌูุฏ ุงููููุงุช ุงูุชุงููุฉ ุจุฏุงุฎูู ุจุงูุฃุณูุงุก ุงูุตุญูุญุฉ: !!!")
    print("board.png, frog.png, spongebob.png, dice_default.png")
    print("dice_roll.wav, ladder_climb.wav, snake_slide.wav, win_game.wav")
    print("*"*30)
    pygame.quit()
    sys.exit()

# --- ุฅุนุฏุงุฏุงุช ุงููุนุจุฉ ูุงููุชุบูุฑุงุช ---
clock = pygame.time.Clock()
# ูุญุงููุฉ ุงุณุชุฎุฏุงู ุฎุท ุนุฑุจู ุฃูุถู ุฅุฐุง ูุงู ูุชุงุญุงูุ ูุฅูุง ุงุณุชุฎุฏุงู ุฎุท ุงุญุชูุงุทู
try:
    font = pygame.font.SysFont('tahoma', 32) # ุฎุท ูุฏุนู ุงูุนุฑุจูุฉ ุจุดูู ุฃูุถู
    small_font = pygame.font.SysFont('tahoma', 22)
except:
    print("ุฎุท 'Tahoma' ุบูุฑ ููุฌูุฏุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุงูุชุฑุงุถู 'Arial'.")
    font = pygame.font.SysFont('arial', 30)
    small_font = pygame.font.SysFont('arial', 20)


# ุชุนุฑูู ุฃูุงูู ุงูุณูุงูู ูุงูุซุนุงุจูู (ูู ูุฑุจุน ุงูุจุฏุงูุฉ ุฅูู ูุฑุจุน ุงูููุงูุฉ)
# ููููู ุชุนุฏูู ูุฐู ุงูููู ูุชูุงุณุจ ููุญุฉ ุงููุนุจ ุงูุฎุงุตุฉ ุจู
ladders = {3: 21, 8: 30, 28: 84, 58: 77, 75: 86, 80: 100, 90: 91}
snakes = {17: 13, 52: 29, 57: 40, 62: 22, 88: 18, 95: 51, 97: 79}

# ููุงูุน ุงููุงุนุจูู (ุชุจุฏุฃ ูู 0ุ ุฎุงุฑุฌ ุงูููุญุฉ)
player_positions = {'ูุงูู': 0, 'ุนูู': 0}
player_pieces = {'ูุงูู': frog_img, 'ุนูู': spongebob_img}
player_colors = {'ูุงูู': GREEN, 'ุนูู': YELLOW} # ุชู ุชุบููุฑ ููู ุนูู ููุฃุตูุฑ ูุชูููุฒ ุฃูุถู ูุน ุณุจููุฌ ุจูุจ
players = list(player_positions.keys())
current_player_index = 0
current_player_name = players[current_player_index]

dice_roll = 0
game_over = False
winner = None
message = f"ุฏูุฑ ุงููุงุนุจ: {current_player_name}. ุงุถุบุท ุนูู ุงููุฑุฏ ููุฑูู."
last_action_message = "" # ุฑุณุงูุฉ ูููุตูุฉ ูุขุฎุฑ ุญุฏุซ (ุณูู/ุซุนุจุงู)

# ููุทูุฉ ุงููุฑุฏ (ูุชุญุฏูุฏ ููุงู ุงูุถุบุท)
dice_rect = pygame.Rect(SCREEN_WIDTH - 160, SCREEN_HEIGHT - 140, 100, 100)

# --- ูุธุงุฆู ูุณุงุนุฏุฉ ---

# ุชุญููู ุฑูู ุงููุฑุจุน (1-100) ุฅูู ุฅุญุฏุงุซูุงุช (x, y) ุนูู ุงูุดุงุดุฉ
def get_coords(square):
    if square <= 0: # ุฎุงุฑุฌ ุงูููุญุฉ ุฃู ูู ุงูุจุฏุงูุฉ
        # ูุถุน ุงููุทุน ุฎุงุฑุฌ ุงูููุญุฉ ุจุดูู ูุฑุชุจ ูู ุงูุจุฏุงูุฉ
        if current_player_name == 'ูุงูู' and player_positions['ูุงูู'] == 0:
            return (SQUARE_SIZE // 2, SCREEN_HEIGHT - SQUARE_SIZE // 2)
        elif current_player_name == 'ุนูู' and player_positions['ุนูู'] == 0:
             return (BOARD_SIZE - SQUARE_SIZE // 2, SCREEN_HEIGHT - SQUARE_SIZE // 2)
        else: # ุฅุฐุง ูุงู ูุงุนุจ ุขุฎุฑ ูู ุงููุฑุจุน 0 ุฃุซูุงุก ุงููุนุจ (ุบูุฑ ูุญุชูู ููู ุงุญุชูุงุทุงู)
            return (-SQUARE_SIZE, -SQUARE_SIZE)

    row = (square - 1) // 10
    col = (square - 1) % 10

    # ุงูุตููู ุงูุฒูุฌูุฉ (0, 2, ..) ุชุชุญุฑู ูู ุงููุณุงุฑ ููููููุ ูุงููุฑุฏูุฉ (1, 3, ..) ูู ุงููููู ูููุณุงุฑ
    if row % 2 != 0:
        col = 9 - col # ุนูุณ ุงูุนููุฏ ููุตููู ุงููุฑุฏูุฉ

    x = col * SQUARE_SIZE
    y = (9 - row) * SQUARE_SIZE # Y ูุจุฏุฃ ูู ุงูุฃุนูู (ูุฑุจุน 100) ููุฃุณูู (ูุฑุจุน 1)
    # ุฅุถุงูุฉ ุฅุฒุงุญุฉ ุจุณูุทุฉ ูุชูุณูุท ุงููุทุน ุฏุงุฎู ุงููุฑุจุน
    center_x = x + SQUARE_SIZE // 2
    center_y = y + SQUARE_SIZE // 2
    return center_x, center_y

# --- ูุธุงุฆู ุงูุฑุณู ---

def draw_board():
    screen.blit(board_img, (0, 0))
    # ูููู ุฅุถุงูุฉ ุฑุณู ุฃุฑูุงู ุงููุฑุจุนุงุช ููุง ุฅุฐุง ูู ุชูู ูุงุถุญุฉ ุฌุฏุงู ูู ุงูุตูุฑุฉ
    # for i in range(1, 101):
    #     x, y = get_coords(i)
    #     # ุชุนุฏูู ููุญุตูู ุนูู ุงูุฑูู ุงูุนููู ุงูุฃูุณุฑ ูููุฑุจุน
    #     sq_x = (x - SQUARE_SIZE // 2)
    #     sq_y = (y - SQUARE_SIZE // 2)
    #     num_text = small_font.render(str(i), True, BLACK)
    #     screen.blit(num_text, (sq_x + 5, sq_y + 5)) # ุฅุถุงูุฉ ุฑูู ูู ุงูุฒุงููุฉ

def draw_pieces():
    offset_x = SQUARE_SIZE // 5 # ุฅุฒุงุญุฉ ุฃูููุฉ ุฃูุจุฑ ูููุน ุชุทุงุจู ุงููุทุน
    offset_y = SQUARE_SIZE // 6 # ุฅุฒุงุญุฉ ุฑุฃุณูุฉ ุจุณูุทุฉ

    for player_name in players:
        pos = player_positions[player_name]
        piece_img = player_pieces[player_name]
        x, y = get_coords(pos)

        # ุชุญุฏูุฏ ุงูุฅุฒุงุญุฉ ุจูุงุกู ุนูู ุงุณู ุงููุงุนุจ ูุชุฌูุจ ุงูุชุฏุงุฎู ุงููุงูู
        current_offset_x = -offset_x if player_name == 'ูุงูู' else offset_x

        # ุฅุฐุง ูุงู ุงููุงุนุจุงู ูู ููุณ ุงููุฑุจุน (ูููุณ ุงููุฑุจุน 0)
        if pos != 0 and player_positions['ูุงูู'] == player_positions['ุนูู']:
             draw_x = x - piece_img.get_width() // 2 + current_offset_x
             draw_y = y - piece_img.get_height() // 2
        else: # ุฅุฐุง ูุงู ุงููุงุนุจ ูู ูุฑุจุน ููุญุฏู ุฃู ูู ุงูุจุฏุงูุฉ (ุงููุฑุจุน 0)
             draw_x = x - piece_img.get_width() // 2
             draw_y = y - piece_img.get_height() // 2

        screen.blit(piece_img, (draw_x, draw_y))


def draw_ui():
    # ููุทูุฉ ุฎูููุฉ ููุงุฌูุฉ ุงููุณุชุฎุฏู
    ui_rect = pygame.Rect(0, BOARD_SIZE, SCREEN_WIDTH, SCREEN_HEIGHT - BOARD_SIZE)
    pygame.draw.rect(screen, LIGHT_BLUE, ui_rect)
    ui_border = pygame.Rect(0, BOARD_SIZE, SCREEN_WIDTH, 5)
    pygame.draw.rect(screen, BLACK, ui_border)

    # ุฑุณู ุงููุฑุฏ (ุฏุงุฆูุงู ุงูุตูุฑุฉ ุงูุงูุชุฑุงุถูุฉ)
    dice_display_rect = dice_img_default.get_rect(center=dice_rect.center)
    screen.blit(dice_img_default, dice_display_rect)

    # ุนุฑุถ ุฑูู ุงููุฑุฏ ุงูุฃุฎูุฑ ุจูุถูุญ
    if dice_roll > 0:
        dice_text = font.render(f"{dice_roll}", True, BLACK)
        # ูุถุน ุงููุต ุชุญุช ุงููุฑุฏ
        dice_text_rect = dice_text.get_rect(center=(dice_rect.centerx, dice_rect.bottom + 20))
        screen.blit(dice_text, dice_text_rect)

    # ุนุฑุถ ุฑุณุงูุฉ ุงูุฏูุฑ ูุงูุญุฏุซ ุงูุฃุฎูุฑ
    current_player_color = player_colors[current_player_name]
    turn_msg_render = font.render(message, True, current_player_color, LIGHT_BLUE) # ุฎูููุฉ ูุชุฌูุจ ุชุฏุงุฎู ุงููุต
    turn_msg_rect = turn_msg_render.get_rect(midtop=(SCREEN_WIDTH // 2 - 100, BOARD_SIZE + 15))
    screen.blit(turn_msg_render, turn_msg_rect)

    if last_action_message:
        action_msg_render = small_font.render(last_action_message, True, BLACK, LIGHT_BLUE)
        action_msg_rect = action_msg_render.get_rect(midtop=(SCREEN_WIDTH // 2 - 100, turn_msg_rect.bottom + 10))
        screen.blit(action_msg_render, action_msg_rect)

    # ุนุฑุถ ููุงูุน ุงููุงุนุจูู
    malik_score_text = small_font.render(f"ูุงูู (ุถูุฏุน): ูุฑุจุน {player_positions['ูุงูู']}", True, player_colors['ูุงูู'])
    ali_score_text = small_font.render(f"ุนูู (ุณุจููุฌ ุจูุจ): ูุฑุจุน {player_positions['ุนูู']}", True, player_colors['ุนูู'])
    screen.blit(malik_score_text, (30, BOARD_SIZE + 20))
    screen.blit(ali_score_text, (30, BOARD_SIZE + 50))

    # ุฑุณุงูุฉ ุงูููุฒ ุฃู ุดุงุดุฉ ุงูุจุฏุงูุฉ
    if game_over:
        # ุดุงุดุฉ ููุงูุฉ ุงููุนุจุฉ
        overlay = pygame.Surface((BOARD_SIZE, BOARD_SIZE), pygame.SRCALPHA) # ุณุทุญ ุดุจู ุดูุงู
        overlay.fill((200, 200, 200, 180)) # ููู ุฑูุงุฏู ุดุจู ุดูุงู
        screen.blit(overlay, (0,0))

        win_text = font.render(f"!!! ุชูุงูููุง !!!", True, RED)
        win_rect = win_text.get_rect(center=(BOARD_SIZE // 2, BOARD_SIZE // 2 - 60))
        screen.blit(win_text, win_rect)

        winner_text = font.render(f"ุงููุงุนุจ {winner} ูุงุฒ ุจุงููุนุจุฉ!", True, player_colors[winner])
        winner_rect = winner_text.get_rect(center=(BOARD_SIZE // 2, BOARD_SIZE // 2 - 10))
        screen.blit(winner_text, winner_rect)

        restart_text = small_font.render("ุงุถุบุท R ูุฅุนุงุฏุฉ ุงููุนุจ ุฃู Q ููุฎุฑูุฌ", True, BLACK)
        restart_rect = restart_text.get_rect(center=(BOARD_SIZE // 2, BOARD_SIZE // 2 + 40))
        screen.blit(restart_text, restart_rect)


# --- ููุทู ุงููุนุจุฉ ---

def roll_dice_action():
    global dice_roll, message, last_action_message, current_player_index, current_player_name
    if game_over or action_pending: return # ูุง ุชูุนู ุดูุฆุงู ุฅุฐุง ุงูุชูุช ุงููุนุจุฉ ุฃู ูุงู ููุงู ุญุฑูุฉ ููุฏ ุงูุงูุชุธุงุฑ

    dice_roll = random.randint(1, 6)
    dice_sound.play() # ุชุดุบูู ุตูุช ุงููุฑุฏ
    message = f"{current_player_name} ุฑูู ุงููุฑุฏ: {dice_roll}"
    last_action_message = "" # ูุณุญ ุฑุณุงูุฉ ุงูุญุฏุซ ุงูุณุงุจู ุนูุฏ ุงูุฑูู
    pygame.event.post(pygame.event.Event(pygame.USEREVENT + 1)) # ุฅุฑุณุงู ุญุฏุซ ูุจุฏุก ุงูุชุญุฑูู ููุฑุงู


def move_player():
    global player_positions, current_player_index, current_player_name, game_over, winner, message, last_action_message, dice_roll, action_pending

    current_pos = player_positions[current_player_name]
    new_pos = current_pos + dice_roll
    landed_on = new_pos # ูุชุชุจุน ุงููุฑุจุน ุงูุฃุตูู ูุจู ุงูุณูู/ุงูุซุนุจุงู

    # ุงูุชุญูู ูู ุชุฌุงูุฒ ุงููุฑุจุน 100
    if new_pos > 100:
        new_pos = current_pos # ูุจูู ูู ููุงูู
        last_action_message = f"ุชุญุชุงุฌ {100 - current_pos} ุจุงูุถุจุท ููููุฒ! ุงุจู ููุงูู."
    elif new_pos == 100:
        player_positions[current_player_name] = 100
        game_over = True
        winner = current_player_name
        message = f"ุงููุงุนุจ {winner} ูุตู ุฅูู ุงูููุงูุฉ!"
        last_action_message = "๐๐๐ ููููููููููููููุงุฒ ๐๐๐"
        win_sound.play() # ุชุดุบูู ุตูุช ุงูููุฒ
        dice_roll = 0 # ุฅููุงู ุนุฑุถ ุฑูู ุงููุฑุฏ ุนูุฏ ุงูููุฒ
        return # ุฅููุงุก ุงูุญุฑูุฉ ุนูุฏ ุงูููุฒ
    else:
         player_positions[current_player_name] = new_pos
         last_action_message = f"ุงูุชูู ุฅูู ุงููุฑุจุน {new_pos}."

         # ุงูุชุญูู ูู ุงูุณูุงูู
         if new_pos in ladders:
             destination = ladders[new_pos]
             player_positions[current_player_name] = destination
             last_action_message = f"ุฑุงุฆุน! ุตุนุฏ ุงูุณูู ูู {new_pos} ุฅูู {destination}!"
             ladder_sound.play() # ุชุดุบูู ุตูุช ุงูุณูู
             # ุงูุชุญุฏูุซ ุงูููุฑู ููุฑุณุงูุฉ (ุณูุชู ุฑุณููุง ูู ุงูุฅุทุงุฑ ุงูุชุงูู)

         # ุงูุชุญูู ูู ุงูุซุนุงุจูู
         elif new_pos in snakes:
             destination = snakes[new_pos]
             player_positions[current_player_name] = destination
             last_action_message = f"ุฃูู! ูุฏุบู ุงูุซุนุจุงู ูู {new_pos} ููุฒู ุฅูู {destination}!"
             snake_sound.play() # ุชุดุบูู ุตูุช ุงูุซุนุจุงู
             # ุงูุชุญุฏูุซ ุงูููุฑู ููุฑุณุงูุฉ

    # ุชุบููุฑ ุฏูุฑ ุงููุงุนุจ ุจุนุฏ ุงูุชูุงุก ุงูุญุฑูุฉ ูุงูุชุญูู ูู ุงูุณูู/ุงูุซุนุจุงู
    if not game_over:
        # ุงูุชุฃูุฏ ูู ุนุฏู ุชุบููุฑ ุงูุฏูุฑ ุฅุฐุง ูุงูุช ููุณ ุงููุชูุฌุฉ ุชุคุฏู ูุณูู/ุซุนุจุงู ูุฑุฉ ุฃุฎุฑู (ุบูุฑ ูุญุชูู ููุง)
        if player_positions[current_player_name] != landed_on:
            # ุฅุฐุง ุชุญุฑู ุจุณุจุจ ุณูู/ุซุนุจุงูุ ุงูุชุธุฑ ููููุงู ูุจู ุชุบููุฑ ุงูุฏูุฑ
             pygame.time.set_timer(pygame.USEREVENT + 2, 800) # 800 ูููู ุซุงููุฉ
        else:
            # ุฅุฐุง ูู ููู ููุงู ุณูู/ุซุนุจุงูุ ุบูุฑ ุงูุฏูุฑ ููุฑุงู
            switch_turn()

def switch_turn():
    """ูุธููุฉ ูููุตูุฉ ูุชุจุฏูู ุงูุฏูุฑ ูุชุญุฏูุซ ุงูุฑุณุงูุฉ"""
    global current_player_index, current_player_name, message, dice_roll, action_pending
    current_player_index = (current_player_index + 1) % len(players)
    current_player_name = players[current_player_index]
    message = f"ุฏูุฑ ุงููุงุนุจ: {current_player_name}. ุงุถุบุท ุนูู ุงููุฑุฏ."
    # ูุง ููุณุญ last_action_message ููุง ููุจูู ุธุงูุฑุงู ุญุชู ุงูุฑููุฉ ุงูุชุงููุฉ
    dice_roll = 0 # ุฅุฎูุงุก ุฑูู ุงููุฑุฏ ุงูุณุงุจู ุงุณุชุนุฏุงุฏุงู ููุฏูุฑ ุงูุฌุฏูุฏ
    action_pending = False # ุงูุณูุงุญ ุจุงูุฑูู ูุฌุฏุฏุงู ููุงุนุจ ุงูุชุงูู


def reset_game():
    global player_positions, current_player_index, current_player_name, dice_roll, game_over, winner, message, last_action_message, action_pending
    player_positions = {'ูุงูู': 0, 'ุนูู': 0}
    current_player_index = 0
    current_player_name = players[current_player_index]
    dice_roll = 0
    game_over = False
    winner = None
    message = f"ุฏูุฑ ุงููุงุนุจ: {current_player_name}. ุงุถุบุท ุนูู ุงููุฑุฏ ููุฑูู."
    last_action_message = "ุชู ุฅุนุงุฏุฉ ุจุฏุก ุงููุนุจุฉ!"
    action_pending = False
    # ุฅูุบุงุก ุฃู ูุคูุชุงุช ูุดุทุฉ
    pygame.time.set_timer(pygame.USEREVENT + 1, 0)
    pygame.time.set_timer(pygame.USEREVENT + 2, 0)
    # ุฅููุงู ุฃู ุฃุตูุงุช ูุฏ ุชููู ูุง ุชุฒุงู ุชุนูู (ุงุญุชูุงุทู)
    pygame.mixer.stop()


# --- ุญููุฉ ุงููุนุจุฉ ุงูุฑุฆูุณูุฉ ---
running = True
action_pending = False # ูุชุบูุฑ ูููุน ุงูููุฑ ุงููุชุนุฏุฏ ุฃุซูุงุก ุญุฑูุฉ ุงููุทุนุฉ

while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

        # --- ุงูุชุนุงูู ูุน ุงููุฏุฎูุงุช ---
        if not game_over:
            if event.type == pygame.MOUSEBUTTONDOWN:
                # ุงูุชุญูู ูู ุงูุถุบุท ุนูู ุงููุฑุฏ (ููุท ุฅุฐุง ูู ููู ููุงู ุญุฑูุฉ ููุฏ ุงูุชูููุฐ)
                if dice_rect.collidepoint(event.pos) and not action_pending:
                    action_pending = True # ููุน ุงูููุฑ ูุฑุฉ ุฃุฎุฑู ููุฑุงู
                    roll_dice_action() # ุฑูู ุงููุฑุฏ ูุจุฏุก ุนูููุฉ ุงูุญุฑูุฉ

            # ุญุฏุซ ูุฎุตุต ูุจุฏุก ุชุญุฑูู ุงููุงุนุจ (ูุชู ุฅุฑุณุงูู ูู roll_dice_action)
            if event.type == pygame.USEREVENT + 1:
                move_player()
                # ุฅุฐุง ูู ุชูุชู ุงููุนุจุฉ ููู ููู ููุงู ุณูู/ุซุนุจุงู (ุญูุซ ูุชู ุชุฃุฎูุฑ ุชุบููุฑ ุงูุฏูุฑ)ุ ุบูุฑ ุงูุฏูุฑ ุงูุขู
                if not game_over and player_positions[current_player_name] == current_pos + dice_roll:
                     switch_turn()


            # ุญุฏุซ ูุฎุตุต ูุชุบููุฑ ุงูุฏูุฑ ุจุนุฏ ุชุฃุฎูุฑ (ุจุณุจุจ ุณูู/ุซุนุจุงู)
            if event.type == pygame.USEREVENT + 2:
                 pygame.time.set_timer(pygame.USEREVENT + 2, 0) # ุฅููุงู ุงููุคูุช
                 switch_turn() # ุงูุขู ุบูุฑ ุงูุฏูุฑ

        # --- ุงูุชุนุงูู ูุน ุงููุฏุฎูุงุช ุจุนุฏ ุงูุชูุงุก ุงููุนุจุฉ ---
        else: # ุฅุฐุง ูุงูุช game_over == True
             if event.type == pygame.KEYDOWN:
                 if event.key == pygame.K_r: # ุงูุถุบุท ุนูู R ูุฅุนุงุฏุฉ ุงููุนุจ
                     reset_game()
                 if event.key == pygame.K_q: # ุงูุถุบุท ุนูู Q ููุฎุฑูุฌ
                      running = False

    # --- ุงูุฑุณู (ูุชู ุฏุงุฆูุงู) ---
    screen.fill(WHITE) # ูุณุญ ุงูุดุงุดุฉ ูู ูู ุฅุทุงุฑ
    draw_board()
    draw_pieces()
    draw_ui() # ุฑุณู ูุงุฌูุฉ ุงููุณุชุฎุฏู (ุจูุง ูู ุฐูู ุงููุฑุฏ ูุงูุฑุณุงุฆู ูุดุงุดุฉ ุงูููุฒ ุฅุฐุง game_over)

    # --- ุชุญุฏูุซ ุงูุดุงุดุฉ ---
    pygame.display.flip()

    # --- ุชุญุฏูุฏ ูุนุฏู ุงูุฅุทุงุฑุงุช ---
    clock.tick(30) # 30 ุฅุทุงุฑ ูู ุงูุซุงููุฉ ููุญูุงุธ ุนูู ุณูุงุณุฉ ุงูุฃุฏุงุก

# --- ุฅููุงุก Pygame ---
pygame.quit()
sys.exit()
